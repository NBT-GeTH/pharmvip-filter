#!/bin/bash
vcfFile="$1"
output="$2"
outputName="$3"
pathWin="$4"
position_CPIC="chr1:201060815-201060815 chr1:201091993-201091993 chr7:117509035-117509035 chr7:117509069-117509069 chr7:117509089-117509089 chr7:117509123-117509123 chr7:117530953-117530953 chr7:117530955-117530955 chr7:117530974-117530974 chr7:117530975-117530975 chr7:117534318-117534318 chr7:117534363-117534363 chr7:117534366-117534366 chr7:117535285-117535285 chr7:117540270-117540270 chr7:117540285-117540285 chr7:117548795-117548795 chr7:117559592-117559594 chr7:117587799-117587799 chr7:117587800-117587800 chr7:117587801-117587801 chr7:117587805-117587805 chr7:117587806-117587806 chr7:117590409-117590409 chr7:117594930-117594930 chr7:117602868-117602868 chr7:117603708-117603708 chr7:117606695-117606695 chr7:117611555-117611555 chr7:117611595-117611595 chr7:117611620-117611620 chr7:117611640-117611640 chr7:117611646-117611646 chr7:117611649-117611649 chr7:117611650-117611650 chr7:117611663-117611663 chr7:117614699-117614699 chr7:117639961-117639961 chr7:117642472-117642472 chr7:117642483-117642483 chr7:117642528-117642528 chr7:117664770-117664770 chr19:40991224-40991224 chr19:40991367-40991367 chr19:40991369-40991369 chr19:40991381-40991381 chr19:40991388-40991388 chr19:40991390-40991390 chr19:40991391-40991391 chr19:40991441-40991441 chr19:41004015-41004015 chr19:41004125-41004125 chr19:41004158-41004158 chr19:41004303-41004303 chr19:41004377-41004377 chr19:41004381-41004381 chr19:41004406-41004406 chr19:41006919-41006919 chr19:41006923-41006923 chr19:41006936-41006936 chr19:41006968-41006968 chr19:41007013-41007013 chr19:41009350-41009350 chr19:41009358-41009358 chr19:41010006-41010006 chr19:41010088-41010088 chr19:41010108-41010108 chr19:41012316-41012316 chr19:41012339-41012339 chr19:41012465-41012465 chr19:41012693-41012693 chr19:41012740-41012740 chr19:41012803-41012803 chr19:41016726-41016726 chr19:41016778-41016778 chr19:41016805-41016805 chr19:41016810-41016810 chr10:94936917-94936917 chr10:94938683-94938683 chr10:94938737-94938737 chr10:94938771-94938771 chr10:94938803-94938803 chr10:94938828-94938828 chr10:94941897-94941897 chr10:94941915-94941915 chr10:94941958-94941958 chr10:94941976-94941976 chr10:94941982-94941982 chr10:94942018-94942018 chr10:94942213-94942222 chr10:94942230-94942230 chr10:94942231-94942231 chr10:94942234-94942234 chr10:94942249-94942249 chr10:94942254-94942254 chr10:94942255-94942255 chr10:94942290-94942290 chr10:94942305-94942305 chr10:94942309-94942309 chr10:94947782-94947782 chr10:94947785-94947785 chr10:94947907-94947907 chr10:94947917-94947917 chr10:94947938-94947938 chr10:94949129-94949129 chr10:94949144-94949144 chr10:94949217-94949217 chr10:94949280-94949280 chr10:94949283-94949283 chr10:94972119-94972119 chr10:94972134-94972134 chr10:94972179-94972179 chr10:94972180-94972180 chr10:94972233-94972233 chr10:94981201-94981201 chr10:94981224-94981224 chr10:94981225-94981225 chr10:94981230-94981230 chr10:94981250-94981250 chr10:94981281-94981281 chr10:94981296-94981296 chr10:94981297-94981297 chr10:94981301-94981301 chr10:94981302-94981302 chr10:94981365-94981365 chr10:94986042-94986042 chr10:94986073-94986073 chr10:94988855-94988855 chr10:94988917-94988917 chr10:94988925-94988925 chr10:94988955-94988955 chr10:94988984-94988984 chr10:94989020-94989020 chr10:94989023-94989023 chr10:94761900-94761900 chr10:94762706-94762706 chr10:94762712-94762712 chr10:94762715-94762715 chr10:94762755-94762755 chr10:94762760-94762760 chr10:94762788-94762788 chr10:94762856-94762856 chr10:94775106-94775106 chr10:94775121-94775121 chr10:94775160-94775160 chr10:94775185-94775185 chr10:94775367-94775367 chr10:94775416-94775416 chr10:94775453-94775453 chr10:94775489-94775489 chr10:94775507-94775507 chr10:94780574-94780574 chr10:94780579-94780579 chr10:94780653-94780653 chr10:94781858-94781858 chr10:94781859-94781859 chr10:94781944-94781944 chr10:94781999-94781999 chr10:94842861-94842861 chr10:94842866-94842866 chr10:94842879-94842879 chr10:94842995-94842995 chr10:94849995-94849995 chr10:94852738-94852738 chr10:94852765-94852765 chr10:94852785-94852785 chr10:94852914-94852914 chr7:99652613-99652613 chr7:99652770-99652771 chr7:99660516-99660516 chr7:99665212-99665212 chr7:99665237-99665237 chr7:99666950-99666950 chr7:99672916-99672916 chr7:99676198-99676198 chr19:15879621-15879621 chr19:15897578-15897578 chr1:97078987-97078987 chr1:97078993-97078993 chr1:97079005-97079005 chr1:97079071-97079071 chr1:97079076-97079076 chr1:97079077-97079077 chr1:97079121-97079121 chr1:97079133-97079133 chr1:97079139-97079139 chr1:97082365-97082365 chr1:97082391-97082391 chr1:97098598-97098598 chr1:97098599-97098599 chr1:97098616-97098616 chr1:97098632-97098632 chr1:97193109-97193109 chr1:97193209-97193209 chr1:97234958-97234958 chr1:97234991-97234991 chr1:97235033-97235033 chr1:97305279-97305279 chr1:97305363-97305363 chr1:97305364-97305364 chr1:97305372-97305372 chr1:97306195-97306195 chr1:97373598-97373598 chr1:97373629-97373629 chr1:97382461-97382461 chr1:97450058-97450058 chr1:97450059-97450059 chr1:97450067-97450067 chr1:97450068-97450068 chr1:97450168-97450168 chr1:97450187-97450187 chr1:97450189-97450189 chr1:97450190-97450190 chr1:97515686-97515686 chr1:97515687-97515687 chr1:97515784-97515784 chr1:97515787-97515787 chr1:97515839-97515839 chr1:97515851-97515851 chr1:97515865-97515865 chr1:97515889-97515889 chr1:97515923-97515923 chr1:97549565-97549565 chr1:97549600-97549600 chr1:97549609-97549609 chr1:97549681-97549681 chr1:97549713-97549713 chr1:97549726-97549726 chr1:97549735-97549735 chr1:97549850-97549850 chr1:97573785-97573785 chr1:97573805-97573805 chr1:97573821-97573821 chr1:97573839-97573839 chr1:97573863-97573863 chr1:97573881-97573881 chr1:97573918-97573918 chr1:97573919-97573919 chr1:97573943-97573943 chr1:97573985-97573985 chr1:97573998-97573998 chr1:97579893-97579893 chr1:97593238-97593238 chr1:97593289-97593289 chr1:97593322-97593322 chr1:97593343-97593343 chr1:97593379-97593379 chr1:97594925-97594925 chr1:97595083-97595083 chr1:97595088-97595088 chr1:97595149-97595149 chr1:97679004-97679004 chr1:97679054-97679054 chr1:97679170-97679170 chr1:97679300-97679300 chr1:97691776-97691776 chr1:97691806-97691806 chr1:97699212-97699212 chr1:97699399-97699399 chr1:97699430-97699430 chr1:97699474-97699474 chr1:97699506-97699506 chr1:97699533-97699533 chr1:97699535-97699535 chr1:97721542-97721542 chr1:97721650-97721650 chr1:97740400-97740400 chr1:97740411-97740414 chr1:97740415-97740418 chr1:97740602-97740602 chr1:97828265-97828265 chr1:97883329-97883329 chr1:97883352-97883352 chr1:97883353-97883353 chr1:97883368-97883368 chrX:154532046-154532046 chrX:154532058-154532060 chrX:154532082-154532082 chrX:154532083-154532083 chrX:154532085-154532085 chrX:154532086-154532086 chrX:154532203-154532203 chrX:154532231-154532231 chrX:154532245-154532245 chrX:154532257-154532257 chrX:154532258-154532258 chrX:154532264-154532264 chrX:154532265-154532265 chrX:154532269-154532269 chrX:154532278-154532278 chrX:154532279-154532279 chrX:154532389-154532389 chrX:154532390-154532390 chrX:154532392-154532392 chrX:154532403-154532403 chrX:154532408-154532408 chrX:154532411-154532411 chrX:154532432-154532432 chrX:154532434-154532434 chrX:154532439-154532439 chrX:154532458-154532458 chrX:154532459-154532459 chrX:154532570-154532570 chrX:154532590-154532590 chrX:154532608-154532608 chrX:154532623-154532623 chrX:154532625-154532625 chrX:154532626-154532626 chrX:154532628-154532628 chrX:154532629-154532629 chrX:154532634-154532634 chrX:154532639-154532639 chrX:154532649-154532649 chrX:154532661-154532661 chrX:154532662-154532662 chrX:154532667-154532667 chrX:154532674-154532674 chrX:154532676-154532676 chrX:154532677-154532677 chrX:154532679-154532679 chrX:154532688-154532688 chrX:154532692-154532692 chrX:154532694-154532694 chrX:154532695-154532695 chrX:154532698-154532698 chrX:154532699-154532699 chrX:154532700-154532700 chrX:154532701-154532701 chrX:154532713-154532713 chrX:154532715-154532715 chrX:154532716-154532716 chrX:154532722-154532722 chrX:154532753-154532770 chrX:154532772-154532772 chrX:154532773-154532773 chrX:154532797-154532797 chrX:154532802-154532802 chrX:154532945-154532945 chrX:154532956-154532956 chrX:154532969-154532969 chrX:154532987-154532987 chrX:154532989-154532989 chrX:154532990-154532990 chrX:154532991-154532993 chrX:154533004-154533004 chrX:154533015-154533038 chrX:154533044-154533044 chrX:154533064-154533064 chrX:154533072-154533072 chrX:154533077-154533077 chrX:154533083-154533083 chrX:154533122-154533122 chrX:154533586-154533586 chrX:154533587-154533587 chrX:154533589-154533589 chrX:154533591-154533591 chrX:154533592-154533592 chrX:154533596-154533596 chrX:154533605-154533605 chrX:154533607-154533607 chrX:154533608-154533608 chrX:154533614-154533614 chrX:154533615-154533615 chrX:154533619-154533619 chrX:154533620-154533620 chrX:154533629-154533629 chrX:154533634-154533634 chrX:154534036-154534036 chrX:154534076-154534081 chrX:154534092-154534092 chrX:154534102-154534102 chrX:154534110-154534110 chrX:154534120-154534122 chrX:154534125-154534125 chrX:154534126-154534126 chrX:154534157-154534157 chrX:154534345-154534345 chrX:154534348-154534348 chrX:154534387-154534387 chrX:154534389-154534389 chrX:154534390-154534390 chrX:154534409-154534409 chrX:154534419-154534421 chrX:154534438-154534438 chrX:154534440-154534440 chrX:154534447-154534447 chrX:154534455-154534455 chrX:154534463-154534463 chrX:154534465-154534465 chrX:154534468-154534468 chrX:154534485-154534485 chrX:154534486-154534486 chrX:154534489-154534489 chrX:154534494-154534494 chrX:154534495-154534495 chrX:154535176-154535176 chrX:154535180-154535180 chrX:154535187-154535187 chrX:154535190-154535190 chrX:154535211-154535211 chrX:154535244-154535244 chrX:154535247-154535247 chrX:154535249-154535249 chrX:154535261-154535261 chrX:154535269-154535269 chrX:154535270-154535270 chrX:154535274-154535274 chrX:154535277-154535277 chrX:154535278-154535278 chrX:154535301-154535301 chrX:154535316-154535316 chrX:154535330-154535330 chrX:154535336-154535336 chrX:154535342-154535342 chrX:154535370-154535372 chrX:154535379-154535379 chrX:154535962-154535962 chrX:154535963-154535963 chrX:154535980-154535980 chrX:154535995-154535995 chrX:154535996-154535996 chrX:154536002-154536002 chrX:154536008-154536008 chrX:154536019-154536019 chrX:154536022-154536024 chrX:154536025-154536025 chrX:154536032-154536032 chrX:154536034-154536034 chrX:154536035-154536035 chrX:154536045-154536045 chrX:154536151-154536151 chrX:154536156-154536156 chrX:154536168-154536168 chrX:154536169-154536169 chrX:154546046-154546046 chrX:154546051-154546053 chrX:154546057-154546057 chrX:154546061-154546061 chrX:154546116-154546116 chrX:154546122-154546122 chrX:154546131-154546131 chr19:39248147-39248147 chr13:48037748-48037748 chr13:48037749-48037749 chr13:48037783-48037788 chr13:48037798-48037798 chr13:48037801-48037802 chr13:48037826-48037827 chr13:48037834-48037834 chr13:48037847-48037847 chr13:48037849-48037849 chr13:48037885-48037885 chr13:48037902-48037902 chr13:48040982-48040982 chr13:48041103-48041104 chr13:48041113-48041113 chr13:48045719-48045719 chr13:48045720-48045720 chr13:48045771-48045771 chr19:38440802-38440802 chr19:38440829-38440829 chr19:38444211-38444211 chr19:38444212-38444212 chr19:38446710-38446710 chr19:38448673-38448673 chr19:38448712-38448712 chr19:38451842-38451842 chr19:38451850-38451850 chr19:38455359-38455359 chr19:38455463-38455463 chr19:38455471-38455471 chr19:38455472-38455472 chr19:38455528-38455528 chr19:38457545-38457545 chr19:38457546-38457546 chr19:38494564-38494564 chr19:38494565-38494565 chr19:38494579-38494579 chr19:38496283-38496283 chr19:38499223-38499223 chr19:38499646-38499648 chr19:38499649-38499651 chr19:38499655-38499655 chr19:38499670-38499670 chr19:38499731-38499731 chr19:38499975-38499975 chr19:38499993-38499993 chr19:38499997-38499997 chr19:38500636-38500636 chr19:38500642-38500642 chr19:38500643-38500643 chr19:38500654-38500654 chr19:38500655-38500655 chr19:38500898-38500898 chr19:38500899-38500899 chr19:38512321-38512321 chr19:38543832-38543832 chr19:38580004-38580004 chr19:38580094-38580094 chr19:38580114-38580114 chr19:38580370-38580370 chr19:38580403-38580403 chr19:38580440-38580440 chr19:38584989-38584989 chr12:21130388-21130388 chr12:21172734-21172734 chr12:21172776-21172776 chr12:21172782-21172782 chr12:21174595-21174595 chr12:21176804-21176804 chr12:21176827-21176827 chr12:21176868-21176868 chr12:21176879-21176879 chr12:21176883-21176883 chr12:21178615-21178615 chr12:21178665-21178665 chr12:21178672-21178672 chr12:21178691-21178691 chr12:21178957-21178957 chr12:21196951-21196951 chr12:21196976-21196976 chr12:21200595-21200595 chr12:21202553-21202553 chr12:21202555-21202555 chr12:21202649-21202649 chr12:21202664-21202664 chr12:21205921-21205921 chr12:21205999-21205999 chr12:21239042-21239042 chr12:21239077-21239077 chr12:21239113-21239113 chr12:21239145-21239145 chr12:21239158-21239158 chr6:18130687-18130687 chr6:18130694-18130694 chr6:18130725-18130725 chr6:18130729-18130729 chr6:18130758-18130758 chr6:18130762-18130762 chr6:18130772-18130772 chr6:18130781-18130781 chr6:18132136-18132136 chr6:18132147-18132147 chr6:18132163-18132163 chr6:18133845-18133845 chr6:18133847-18133847 chr6:18133870-18133870 chr6:18133884-18133884 chr6:18133890-18133890 chr6:18138969-18138969 chr6:18138970-18138970 chr6:18138997-18138997 chr6:18139027-18139027 chr6:18139689-18139689 chr6:18139710-18139710 chr6:18143597-18143597 chr6:18143606-18143606 chr6:18143613-18143613 chr6:18143622-18143622 chr6:18143643-18143643 chr6:18143718-18143718 chr6:18143724-18143724 chr6:18147838-18147838 chr6:18147845-18147845 chr6:18147851-18147851 chr6:18147856-18147856 chr6:18147910-18147910 chr6:18149004-18149004 chr6:18149022-18149022 chr6:18149045-18149045 chr6:18149126-18149126 chr6:18149127-18149127 chr2:233757013-233757013 chr2:233759924-233759924 chr2:233760233-233760233 chr2:233760498-233760498 chr2:233760973-233760973 chr16:31096368-31096368"

vcfFile=$(tr ',' ' ' <<<"${vcfFile}")
output=$(tr ',' ' ' <<<"${output}")
pathWin=$(tr ',' ' ' <<<"${pathWin}")

echo -e '>>> Start filtering CPIC Genes....'
if [ ! -d "${output}/${outputName}_filtered_for_CPIC_Genes/" ]; then
  echo -e '>>> Creating Folder for filtered file....'
  mkdir "${output}/${outputName}_filtered_for_CPIC_Genes/"
fi

if [[ "${vcfFile}" == *.vcf ]]; then
  if [ ! -d "${output}/${outputName}_Compressing/" ]; then
    echo -e '>>> Creating Folder for Compressing file....'
    mkdir "${output}/${outputName}_filtered_for_CPIC_Genes/${outputName}_Compressing"
  fi
  echo -e '>>> Compressing file for Filtering....'
  bgzip -f -c "${vcfFile}" >"${output}/${outputName}_filtered_for_CPIC_Genes/${outputName}_Compressing/${outputName}.vcf.gz"
  echo -e '>>> Indexing file.'
  tabix -f -p vcf "${output}/${outputName}_filtered_for_CPIC_Genes/${outputName}_Compressing/${outputName}.vcf.gz"
  echo -e '>>> Filtering....'
  zgrep "^#" "${output}/${outputName}_filtered_for_CPIC_Genes/${outputName}_Compressing/${outputName}.vcf.gz" >"${output}/${outputName}_filtered_for_CPIC_Genes/extract_region.vcf"
  tabix -f -p vcf "${output}/${outputName}_filtered_for_CPIC_Genes/${outputName}_Compressing/${outputName}.vcf.gz"
  tabix "${output}/${outputName}_filtered_for_CPIC_Genes/${outputName}_Compressing/${outputName}.vcf.gz" $position_CPIC >>"${output}/${outputName}_filtered_for_CPIC_Genes/extract_region.vcf"
  echo -e '>>> Sorting....'
  bcftools sort "${output}/${outputName}_filtered_for_CPIC_Genes/extract_region.vcf" >"${output}/${outputName}_filtered_for_CPIC_Genes/${outputName}_filtered_CPIC.vcf"

  echo -e '>>> Compressing final file....'
  rm "${output}/${outputName}_filtered_for_CPIC_Genes/extract_region.vcf"
  bgzip -f "${output}/${outputName}_filtered_for_CPIC_Genes/${outputName}_filtered_CPIC.vcf"
  echo -e '>>> Indexing final file....'
  tabix -f -p vcf "${output}/${outputName}_filtered_for_CPIC_Genes/${outputName}_filtered_CPIC.vcf.gz"

  echo -e '----------------------------------------'
  echo -e 'Process completed....'
  echo -e '----------------------------------------'
  echo -e "***Please use compressed file for a good of filtering."
  echo -e "> Your file compressed location : ${pathWin}/${outputName}_filtered_for_CPIC_Genes/${outputName}_Compressing"
  echo -e '----------------------------------------'

elif [[ "${vcfFile}" == *.vcf.gz ]]; then
  bcftools view -H "${vcfFile}" 1:3300000-3400000
  check=$(echo $?)
  if [ $check -eq 0 ]; then
    echo -e ">>> The file is indexed."
  else
    echo -e ">>> The file is not indexed."
    echo -e '>>> Indexing file.'
    tabix -f -p vcf "${vcfFile}"
  fi
  echo -e '>>> Filtering....'
  zgrep "^#" "${vcfFile}" >"${output}/${outputName}_filtered_for_CPIC_Genes/extract_region.vcf"
  tabix -f -p vcf "${vcfFile}"
  tabix "${vcfFile}" $position_CPIC >>"${output}/${outputName}_filtered_for_CPIC_Genes/extract_region.vcf"
  echo -e '>>> Sorting....'
  bcftools sort "${output}/${outputName}_filtered_for_CPIC_Genes/extract_region.vcf" >"${output}/${outputName}_filtered_for_CPIC_Genes/${outputName}_filtered_CPIC.vcf"

  echo -e '>>> Compressing final file....'
  rm "${output}/${outputName}_filtered_for_CPIC_Genes/extract_region.vcf"
  bgzip -f "${output}/${outputName}_filtered_for_CPIC_Genes/${outputName}_filtered_CPIC.vcf"
  echo -e '>>> Indexing final file....'
  tabix -f -p vcf "${output}/${outputName}_filtered_for_CPIC_Genes/${outputName}_filtered_CPIC.vcf.gz"

  echo -e '----------------------------------------'
  echo -e 'Process completed....'
  echo -e '----------------------------------------'
fi
